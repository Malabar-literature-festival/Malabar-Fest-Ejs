<!DOCTYPE html>
<html class="no-js" lang="en">
  <link
    rel="shortcut icon"
    type="image/x-icon"
    href="/assets/images/favnew.svg"
  />

  <head>
    <title><%= title %></title>
    <meta name="description" content="<%= metaTags[0].description %>" />
    <meta name="keywords" content="<%= metaTags[1].keywords %>" />
    <meta name="author" content="<%= metaTags[2].author %>" />
    <meta name="robots" content="<%= metaTags[3].robots %>" />
    <%- include('layout/header.ejs') %>
    <!-- Include flatpickr CSS from CDN -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />

    <!-- Include flatpickr JavaScript from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  </head>

  <body>
    <div id="loader" class="loader-overlay">
      <div class="loader"></div>
    </div>

    <div class="main-wrapper">
      <div class="container">
        <div class="attende-registration" style="margin-top: 100px">
          <div class="registration-title">
            <h1>Delegate Registration</h1>
          </div>
          <div style="display: flex; justify-content: center">
            <img style="width: 250px" src="/assets/images/qrcode.jpeg" alt="" />
          </div>
        </div>
      </div>
      <div
        class="register-table"
        style="
          background-image: url('assets/images/RegisterUnion.png');
          background-size: cover;
          background-position: center center;
          width: 100%;
          min-height: 818px;
          display: flex;
          justify-content: center;
          align-items: center;
        "
      >
        <div class="container">
          <div class="delegate-table-section">
            <!-- <div class="delegate-title">
            <h1>Delegate</h1>
          </div> -->
            <div class="register-form">
              <div class="container">
                <form
                  action="/delegate"
                  method="post"
                  enctype="multipart/form-data"
                  id="delegateForm"
                >
                  <input type="hidden" name="type" value="delegate" />

                  <div class="row form_head">
                    <div class="gpay-number">
                      Gpay No: <strong>9562761133</strong>
                    </div>
                    <!-- Note Section Start -->
                    <div class="pay-note-section">
                      <p>
                        <strong>Note: </strong> Please scan the Google Pay QR
                        code or use the Google Pay number 9562761133 for
                        payment. After completing the payment, kindly copy the
                        transaction ID and paste it into the registrationÂ form.
                      </p>
                    </div>
                    <!-- Note Section End -->
                    <!-- <div
                      id="success-message"
                      class="alert alert-success"
                      style="display: none"
                    >
                      Registration successful! Thank you for registering.
                    </div> -->
                    <!-- Modal -->
                    <div id="myModal" class="pay-modal">
                      <div class="pay-modal-content">
                        <span class="pay-close">&times;</span>
                        <p id="modalMessage"></p>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="name">Name:</label>
                        <input
                          type="text"
                          id="name"
                          name="name"
                          class="form-control"
                          required
                        />
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="gender">Gender:</label>
                        <select
                          id="gender"
                          name="gender"
                          class="form-control"
                          required
                        >
                          <option value="Male">Male</option>
                          <option value="Female">Female</option>
                          <option value="Other">Other</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="contact">Contact Number:</label>
                        <input
                          type="tel"
                          id="contact"
                          name="contact"
                          class="form-control"
                          required
                        />
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="email">Email ID:</label>
                        <input
                          type="email"
                          id="email"
                          name="email"
                          class="form-control"
                          required
                        />
                        <p id="emailError" class="text-danger"></p>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="place">City:</label>
                        <input
                          type="text"
                          id="place"
                          name="place"
                          class="form-control"
                          required
                        />
                      </div>
                    </div>

                    <!-- <div class="col-md-6">
                    <div class="form-group">
                      <label for="email">Registered Mail:</label>
                      <input type="email" id="email" name="email" class="form-control" value="<%= savedEmail %>"
                        readonly required />
                      <p id="emailError" class="text-danger"></p>
                    </div>
                  </div> -->
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="photo">Add Photo ( Optional ):</label>
                        <input
                          type="file"
                          id="photo"
                          name="photo"
                          class="form-control-file form-control"
                          style="width: 100%"
                        />
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="professions">profession:</label>
                        <input
                          type="text"
                          id="profession"
                          name="profession"
                          required
                          class="form-control-file form-control"
                          style="width: 100%"
                        />
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="transactionImage"
                          >transaction Screenshot:</label
                        >
                        <input
                          type="file"
                          id="transactionImage"
                          name="transactionImage"
                          class="form-control-file form-control"
                          style="width: 100%"
                          required
                        />
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="transactionId">transaction id:</label>
                        <input
                          type="text"
                          id="transactionId"
                          name="transactionId"
                          class="form-control-file form-control"
                          style="width: 100%"
                        />
                      </div>
                    </div>
                    <!-- 
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="day">Select Day:</label>
                        <input
                          type="text"
                          id="day"
                          name="day"
                          class="form-control datepicker-input"
                          placeholder="Select your Day"
                          required
                        />
                      </div>
                    </div> -->
                  </div>
                  <div class="row register-amount-btn">
                    <div class="col-12 d-flex justify-content-center">
                      <button
                        type="submit"
                        class="btn btn-primary"
                        style="border-radius: 20px"
                      >
                        Register
                      </button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Start -->
    <%- include('layout/footer.ejs') %>
    <!-- Footer End -->

    <!-- JS
  ============================================ -->

    <!-- carousel & jQuery JS -->

    <script src="assets/js/js/jquery.min.js"></script>
    <script src="assets/js/js/owl.carousel.min.js"></script>
    <script src="assets/js/js/main.js"></script>

    <!-- Modernizer & jQuery JS -->
    <script src="assets/js/vendor/modernizr-3.11.7.min.js"></script>
    <script src="assets/js/vendor/jquery-1.12.4.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>

    <!-- Plugins JS -->
    <script src="assets/js/swiper-bundle.min.js"></script>
    <script src="assets/js/back-to-top.js"></script>
    <script src="assets/js/jquery.magnific-popup.min.js"></script>
    <script src="assets/js/jquery.counterup.min.js"></script>
    <script src="assets/js/waypoints.min.js"></script>
    <script src="assets/js/aos.js"></script>
    <script src="assets/js/jquery.nice-select.min.js"></script>
    <!-- Main JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
      type="text/javascript"
      src="node_modules/slick-carousel/slick/slick.min.js"
    ></script>
    <script src="assets/js/main.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("delegateForm");
        const modal = document.getElementById("myModal");
        const closeBtn = document.querySelector(".pay-close"); // Correct class
        const modalMessage = document.getElementById("modalMessage");
        const registerButton = document.querySelector(".btn.btn-primary");
        const loaderOverlay = document.getElementById("loader");

        form.addEventListener("submit", async function (event) {
          event.preventDefault();

          try {
            // Show loader while processing the form
            loaderOverlay.style.display = "flex";

            // Disable the register button to prevent multiple submissions
            registerButton.disabled = true;

            const response = await fetch("/delegate", {
              method: "POST",
              body: new FormData(form),
            });

            // Hide loader after form submission
            loaderOverlay.style.display = "none";

            // Remove the loading spinner after form submission
            registerButton.innerHTML = "Register";
            registerButton.disabled = false;

            if (response) {
              const responseData = await response.json();

              if (responseData.alreadyRegistered) {
                // Display the already registered message in the modal
                modalMessage.innerHTML = "You are already registered.";
              } else if (responseData.message === "Registration success") {
                // Display the success message in the modal
                modalMessage.innerHTML =
                  "Thank you for registering. Our technical team will review and approve your registration. You can expect to receive the ticket in your registered email within the next two days. <br> Help Desk: +91 7907100834";

                // Show the register button after displaying the popup message
                registerButton.style.display = "block";
              } else {
                console.error("Unexpected response:", responseData);
                // Handle unexpected responses if needed
              }

              // Show the modal
              modal.style.display = "block";
              // Remove the button highlight
              registerButton.blur();
              // Clear the form
              form.reset();
            } else {
              // Handle other response statuses (e.g., validation errors)
              const responseData = await response.json();
              console.error(responseData.error);
              // Display an error message if needed
            }
          } catch (error) {
            console.error("Error submitting form:", error);
            // Display an error message if needed
          }
        });

        // Close the modal when the close button is clicked
        closeBtn.addEventListener("click", function () {
          modal.style.display = "none";
        });

        // Close the modal when clicking outside the modal content
        window.addEventListener("click", function (event) {
          if (event.target === modal) {
            modal.style.display = "none";
          }
        });
      });
    </script>
  </body>
</html>
